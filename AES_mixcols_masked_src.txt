void mixcols_masked(uint8_t* in, uint8_t* out, uint8_t a, uint8_t x) {
    uint8_t sboxm[256];
    uint8_t b = rand()%256;

    sboxm[0] = sbox[0^a]^b;
    sboxm[1] = sbox[1^a]^b;
    sboxm[2] = sbox[2^a]^b;
    sboxm[3] = sbox[3^a]^b;
    sboxm[4] = sbox[4^a]^b;
    sboxm[5] = sbox[5^a]^b;
    sboxm[6] = sbox[6^a]^b;
    sboxm[7] = sbox[7^a]^b;
    sboxm[8] = sbox[8^a]^b;
    sboxm[9] = sbox[9^a]^b;
    sboxm[10] = sbox[10^a]^b;
    sboxm[11] = sbox[11^a]^b;
    sboxm[12] = sbox[12^a]^b;
    sboxm[13] = sbox[13^a]^b;
    sboxm[14] = sbox[14^a]^b;
    sboxm[15] = sbox[15^a]^b;
    sboxm[16] = sbox[16^a]^b;
    sboxm[17] = sbox[17^a]^b;
    sboxm[18] = sbox[18^a]^b;
    sboxm[19] = sbox[19^a]^b;
    sboxm[20] = sbox[20^a]^b;
    sboxm[21] = sbox[21^a]^b;
    sboxm[22] = sbox[22^a]^b;
    sboxm[23] = sbox[23^a]^b;
    sboxm[24] = sbox[24^a]^b;
    sboxm[25] = sbox[25^a]^b;
    sboxm[26] = sbox[26^a]^b;
    sboxm[27] = sbox[27^a]^b;
    sboxm[28] = sbox[28^a]^b;
    sboxm[29] = sbox[29^a]^b;
    sboxm[30] = sbox[30^a]^b;
    sboxm[31] = sbox[31^a]^b;
    sboxm[32] = sbox[32^a]^b;
    sboxm[33] = sbox[33^a]^b;
    sboxm[34] = sbox[34^a]^b;
    sboxm[35] = sbox[35^a]^b;
    sboxm[36] = sbox[36^a]^b;
    sboxm[37] = sbox[37^a]^b;
    sboxm[38] = sbox[38^a]^b;
    sboxm[39] = sbox[39^a]^b;
    sboxm[40] = sbox[40^a]^b;
    sboxm[41] = sbox[41^a]^b;
    sboxm[42] = sbox[42^a]^b;
    sboxm[43] = sbox[43^a]^b;
    sboxm[44] = sbox[44^a]^b;
    sboxm[45] = sbox[45^a]^b;
    sboxm[46] = sbox[46^a]^b;
    sboxm[47] = sbox[47^a]^b;
    sboxm[48] = sbox[48^a]^b;
    sboxm[49] = sbox[49^a]^b;
    sboxm[50] = sbox[50^a]^b;
    sboxm[51] = sbox[51^a]^b;
    sboxm[52] = sbox[52^a]^b;
    sboxm[53] = sbox[53^a]^b;
    sboxm[54] = sbox[54^a]^b;
    sboxm[55] = sbox[55^a]^b;
    sboxm[56] = sbox[56^a]^b;
    sboxm[57] = sbox[57^a]^b;
    sboxm[58] = sbox[58^a]^b;
    sboxm[59] = sbox[59^a]^b;
    sboxm[60] = sbox[60^a]^b;
    sboxm[61] = sbox[61^a]^b;
    sboxm[62] = sbox[62^a]^b;
    sboxm[63] = sbox[63^a]^b;
    sboxm[64] = sbox[64^a]^b;
    sboxm[65] = sbox[65^a]^b;
    sboxm[66] = sbox[66^a]^b;
    sboxm[67] = sbox[67^a]^b;
    sboxm[68] = sbox[68^a]^b;
    sboxm[69] = sbox[69^a]^b;
    sboxm[70] = sbox[70^a]^b;
    sboxm[71] = sbox[71^a]^b;
    sboxm[72] = sbox[72^a]^b;
    sboxm[73] = sbox[73^a]^b;
    sboxm[74] = sbox[74^a]^b;
    sboxm[75] = sbox[75^a]^b;
    sboxm[76] = sbox[76^a]^b;
    sboxm[77] = sbox[77^a]^b;
    sboxm[78] = sbox[78^a]^b;
    sboxm[79] = sbox[79^a]^b;
    sboxm[80] = sbox[80^a]^b;
    sboxm[81] = sbox[81^a]^b;
    sboxm[82] = sbox[82^a]^b;
    sboxm[83] = sbox[83^a]^b;
    sboxm[84] = sbox[84^a]^b;
    sboxm[85] = sbox[85^a]^b;
    sboxm[86] = sbox[86^a]^b;
    sboxm[87] = sbox[87^a]^b;
    sboxm[88] = sbox[88^a]^b;
    sboxm[89] = sbox[89^a]^b;
    sboxm[90] = sbox[90^a]^b;
    sboxm[91] = sbox[91^a]^b;
    sboxm[92] = sbox[92^a]^b;
    sboxm[93] = sbox[93^a]^b;
    sboxm[94] = sbox[94^a]^b;
    sboxm[95] = sbox[95^a]^b;
    sboxm[96] = sbox[96^a]^b;
    sboxm[97] = sbox[97^a]^b;
    sboxm[98] = sbox[98^a]^b;
    sboxm[99] = sbox[99^a]^b;
    sboxm[100] = sbox[100^a]^b;
    sboxm[101] = sbox[101^a]^b;
    sboxm[102] = sbox[102^a]^b;
    sboxm[103] = sbox[103^a]^b;
    sboxm[104] = sbox[104^a]^b;
    sboxm[105] = sbox[105^a]^b;
    sboxm[106] = sbox[106^a]^b;
    sboxm[107] = sbox[107^a]^b;
    sboxm[108] = sbox[108^a]^b;
    sboxm[109] = sbox[109^a]^b;
    sboxm[110] = sbox[110^a]^b;
    sboxm[111] = sbox[111^a]^b;
    sboxm[112] = sbox[112^a]^b;
    sboxm[113] = sbox[113^a]^b;
    sboxm[114] = sbox[114^a]^b;
    sboxm[115] = sbox[115^a]^b;
    sboxm[116] = sbox[116^a]^b;
    sboxm[117] = sbox[117^a]^b;
    sboxm[118] = sbox[118^a]^b;
    sboxm[119] = sbox[119^a]^b;
    sboxm[120] = sbox[120^a]^b;
    sboxm[121] = sbox[121^a]^b;
    sboxm[122] = sbox[122^a]^b;
    sboxm[123] = sbox[123^a]^b;
    sboxm[124] = sbox[124^a]^b;
    sboxm[125] = sbox[125^a]^b;
    sboxm[126] = sbox[126^a]^b;
    sboxm[127] = sbox[127^a]^b;
    sboxm[128] = sbox[128^a]^b;
    sboxm[129] = sbox[129^a]^b;
    sboxm[130] = sbox[130^a]^b;
    sboxm[131] = sbox[131^a]^b;
    sboxm[132] = sbox[132^a]^b;
    sboxm[133] = sbox[133^a]^b;
    sboxm[134] = sbox[134^a]^b;
    sboxm[135] = sbox[135^a]^b;
    sboxm[136] = sbox[136^a]^b;
    sboxm[137] = sbox[137^a]^b;
    sboxm[138] = sbox[138^a]^b;
    sboxm[139] = sbox[139^a]^b;
    sboxm[140] = sbox[140^a]^b;
    sboxm[141] = sbox[141^a]^b;
    sboxm[142] = sbox[142^a]^b;
    sboxm[143] = sbox[143^a]^b;
    sboxm[144] = sbox[144^a]^b;
    sboxm[145] = sbox[145^a]^b;
    sboxm[146] = sbox[146^a]^b;
    sboxm[147] = sbox[147^a]^b;
    sboxm[148] = sbox[148^a]^b;
    sboxm[149] = sbox[149^a]^b;
    sboxm[150] = sbox[150^a]^b;
    sboxm[151] = sbox[151^a]^b;
    sboxm[152] = sbox[152^a]^b;
    sboxm[153] = sbox[153^a]^b;
    sboxm[154] = sbox[154^a]^b;
    sboxm[155] = sbox[155^a]^b;
    sboxm[156] = sbox[156^a]^b;
    sboxm[157] = sbox[157^a]^b;
    sboxm[158] = sbox[158^a]^b;
    sboxm[159] = sbox[159^a]^b;
    sboxm[160] = sbox[160^a]^b;
    sboxm[161] = sbox[161^a]^b;
    sboxm[162] = sbox[162^a]^b;
    sboxm[163] = sbox[163^a]^b;
    sboxm[164] = sbox[164^a]^b;
    sboxm[165] = sbox[165^a]^b;
    sboxm[166] = sbox[166^a]^b;
    sboxm[167] = sbox[167^a]^b;
    sboxm[168] = sbox[168^a]^b;
    sboxm[169] = sbox[169^a]^b;
    sboxm[170] = sbox[170^a]^b;
    sboxm[171] = sbox[171^a]^b;
    sboxm[172] = sbox[172^a]^b;
    sboxm[173] = sbox[173^a]^b;
    sboxm[174] = sbox[174^a]^b;
    sboxm[175] = sbox[175^a]^b;
    sboxm[176] = sbox[176^a]^b;
    sboxm[177] = sbox[177^a]^b;
    sboxm[178] = sbox[178^a]^b;
    sboxm[179] = sbox[179^a]^b;
    sboxm[180] = sbox[180^a]^b;
    sboxm[181] = sbox[181^a]^b;
    sboxm[182] = sbox[182^a]^b;
    sboxm[183] = sbox[183^a]^b;
    sboxm[184] = sbox[184^a]^b;
    sboxm[185] = sbox[185^a]^b;
    sboxm[186] = sbox[186^a]^b;
    sboxm[187] = sbox[187^a]^b;
    sboxm[188] = sbox[188^a]^b;
    sboxm[189] = sbox[189^a]^b;
    sboxm[190] = sbox[190^a]^b;
    sboxm[191] = sbox[191^a]^b;
    sboxm[192] = sbox[192^a]^b;
    sboxm[193] = sbox[193^a]^b;
    sboxm[194] = sbox[194^a]^b;
    sboxm[195] = sbox[195^a]^b;
    sboxm[196] = sbox[196^a]^b;
    sboxm[197] = sbox[197^a]^b;
    sboxm[198] = sbox[198^a]^b;
    sboxm[199] = sbox[199^a]^b;
    sboxm[200] = sbox[200^a]^b;
    sboxm[201] = sbox[201^a]^b;
    sboxm[202] = sbox[202^a]^b;
    sboxm[203] = sbox[203^a]^b;
    sboxm[204] = sbox[204^a]^b;
    sboxm[205] = sbox[205^a]^b;
    sboxm[206] = sbox[206^a]^b;
    sboxm[207] = sbox[207^a]^b;
    sboxm[208] = sbox[208^a]^b;
    sboxm[209] = sbox[209^a]^b;
    sboxm[210] = sbox[210^a]^b;
    sboxm[211] = sbox[211^a]^b;
    sboxm[212] = sbox[212^a]^b;
    sboxm[213] = sbox[213^a]^b;
    sboxm[214] = sbox[214^a]^b;
    sboxm[215] = sbox[215^a]^b;
    sboxm[216] = sbox[216^a]^b;
    sboxm[217] = sbox[217^a]^b;
    sboxm[218] = sbox[218^a]^b;
    sboxm[219] = sbox[219^a]^b;
    sboxm[220] = sbox[220^a]^b;
    sboxm[221] = sbox[221^a]^b;
    sboxm[222] = sbox[222^a]^b;
    sboxm[223] = sbox[223^a]^b;
    sboxm[224] = sbox[224^a]^b;
    sboxm[225] = sbox[225^a]^b;
    sboxm[226] = sbox[226^a]^b;
    sboxm[227] = sbox[227^a]^b;
    sboxm[228] = sbox[228^a]^b;
    sboxm[229] = sbox[229^a]^b;
    sboxm[230] = sbox[230^a]^b;
    sboxm[231] = sbox[231^a]^b;
    sboxm[232] = sbox[232^a]^b;
    sboxm[233] = sbox[233^a]^b;
    sboxm[234] = sbox[234^a]^b;
    sboxm[235] = sbox[235^a]^b;
    sboxm[236] = sbox[236^a]^b;
    sboxm[237] = sbox[237^a]^b;
    sboxm[238] = sbox[238^a]^b;
    sboxm[239] = sbox[239^a]^b;
    sboxm[240] = sbox[240^a]^b;
    sboxm[241] = sbox[241^a]^b;
    sboxm[242] = sbox[242^a]^b;
    sboxm[243] = sbox[243^a]^b;
    sboxm[244] = sbox[244^a]^b;
    sboxm[245] = sbox[245^a]^b;
    sboxm[246] = sbox[246^a]^b;
    sboxm[247] = sbox[247^a]^b;
    sboxm[248] = sbox[248^a]^b;
    sboxm[249] = sbox[249^a]^b;
    sboxm[250] = sbox[250^a]^b;
    sboxm[251] = sbox[251^a]^b;
    sboxm[252] = sbox[252^a]^b;
    sboxm[253] = sbox[253^a]^b;
    sboxm[254] = sbox[254^a]^b;
    sboxm[255] = sbox[255^a]^b;

    uint8_t temp[4];
    uint8_t t[4];
    uint8_t t2[4];
    t[0] = in[0]^key[0];
    t2[0] = sboxm[t[0]];
    temp[0] = t2[0]
    t[1] = in[1]^key[1];
    t2[1] = sboxm[t[1]];
    temp[1] = t2[1]
    t[2] = in[2]^key[2];
    t2[2] = sboxm[t[2]];
    temp[2] = t2[2]
    t[3] = in[3]^key[3];
    t2[3] = sboxm[t[3]];
    temp[3] = t2[3]

    uint8_t t3x[4];
    uint8_t t3[4];
    uint8_t t4[4];
    uint8_t t5[4];
    uint8_t t6[4];
    uint8_t t7[4];
    t3x[0] = xtime[temp[0]^x;
    t3[0] = t3x[0]^b;
    t4[0] = t3[0]^temp[1];
    t5[0] = t4[0]^xtime[temp[1]];
    t6[0] = t5[0]^temp[2];
    t7[0] = t6[0]^temp[3];
    out[0] = t7[0]^b;
    t3x[1] = xtime[temp[1]^x;
    t3[1] = t3x[1]^b;
    t4[1] = t3[1]^temp[2];
    t5[1] = t4[1]^xtime[temp[2]];
    t6[1] = t5[1]^temp[3];
    t7[1] = t6[1]^temp[0];
    out[1] = t7[1]^b;
    t3x[2] = xtime[temp[2]^x;
    t3[2] = t3x[2]^b;
    t4[2] = t3[2]^temp[3];
    t5[2] = t4[2]^xtime[temp[3]];
    t6[2] = t5[2]^temp[0];
    t7[2] = t6[2]^temp[1];
    out[2] = t7[2]^b;
    t3x[3] = xtime[temp[3]^x;
    t3[3] = t3x[3]^b;
    t4[3] = t3[3]^temp[0];
    t5[3] = t4[3]^xtime[temp[0]];
    t6[3] = t5[3]^temp[1];
    t7[3] = t6[3]^temp[2];
    out[3] = t7[3]^b;
}